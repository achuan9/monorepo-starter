import { writeFileSync } from "node:fs";
import { resolve } from "node:path";
import { COMPONENT_PREFIX } from "../../../scripts/constants";
import { exportMap } from "./export-map";

const INDEX_FILE = resolve(import.meta.dirname, "../src/index.ts");
function generateIndexFile(): void {
  const imports = Object.entries(exportMap)
    .map(([name, component]) => `import ${name} from "${component}";`)
    .join("\n");

  const generatedContent = `
  // This file is generated by scripts/generate-exports.ts
  import type { App } from "vue";
  ${imports}

  export { ${Object.keys(exportMap).join(", ")} };
  export default {
     install(app: App) {
      ${Object.entries(exportMap)
        .map(([name]) => `app.component("${name}", ${name});`)
        .join("\n")}
     },
  }
`;

  console.log(generatedContent);

  writeFileSync(INDEX_FILE, generatedContent, "utf-8");
  console.log("âœ… å·²è‡ªåŠ¨ç”Ÿæˆç»„ä»¶å¯¼å‡ºè¯­å¥");
  console.log(`ğŸ“¦ ç»„ä»¶åˆ—è¡¨: ${Object.keys(exportMap).join(", ")}`);
  console.log(`ğŸ·ï¸  å‰ç¼€: ${COMPONENT_PREFIX}`);
  console.log(
    `ğŸ“ å¯¼å‡ºå: ${Object.keys(exportMap)
      .map((n) => `${COMPONENT_PREFIX}${n}`)
      .join(", ")}`
  );
}

// æ‰§è¡Œç”Ÿæˆ
generateIndexFile();
